<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>rating</title>
    <style>
        .rating{
            width: 120px;
            height: 24px;
            margin: 50px auto;
        }

        .rating-item{
            list-style: none;
            float:left;
            width: 24px;
            height: 24px;
            background: url("img/rating.png") no-repeat;
            background-position: 0 0;
            cursor: pointer;
        }
    </style>
    <script src="http://img.mukewang.com/down/540812440001e40e00000000.js" type="text/javascript"></script>
</head>
<body>
    <ul class="rating" id="rating">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>

    <ul class="rating" id="rating2">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>

    <ul class="rating" id="rating3">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>

    <ul class="rating" id="rating4">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>
<script>

    var rating = (function () {
        var defaultoptions = {
            mode:"entire",
            num: 2,
            readOnly:false,
            select:function () {
                
            },
            chosen:function () {
                
            }
        };


        var  Light  = function(el,options) {
            this.$el = $(el);
            this.$item = this.$el.find(".rating-item");
            this.opts = options;
            this.add = 1;
            this.selectEvent = "mousemve";
        };
        Light.prototype.init = function () {
            console.log(this.opts);
            this.lightOn(this.opts.num);
            if(!this.opts.readOnly){
                this.bindEvent();
            }
        };
        Light.prototype.bindEvent = function (e) {
            var self  = this,
                itemLength = self.$item.length;
            self.$el.on(self.selectEvent,".rating-item",function (e) {
                self.select(e,$(this));
                var num = $(this).index() + self.add;
                self.lightOn(num);
                (typeof self.opts.select  === "function") && self.opts.select.call(this,num ,itemLength);
                self.$el.trigger("select",[num ,itemLength]);
            }).on("click",".rating-item",function () {
                var num = $(this).index() + self.add;
                self.opts.num = num;
                (typeof self.opts.chosen === "function") && self.opts.chosen.call(this,num,itemLength);
                self.$el.trigger("chosen",[num ,itemLength]);
            }).on("mouseout",function () {
                self.lightOn(self.opts.num);
            })
        };
        Light.prototype.lightOn = function (num) {
            num = parseInt(num);
            this.$item.each(function (index) {
                if(index < num){
                    $(this).css("background-position","0 -24px");
                }else{
                    $(this).css("background-position","0 0");
                }
            })
        };
        Light.prototype.select = function () {
            throw new Error("需在子类中实现");
        };
        Light.prototype.unbindEvent = function () {
            this.$el.off();
        }

        var  LightEntire  = function(el,options) {
            Light.call(this,el,options);
            this.selectEvent = "mouseover";
        };
        // LightEntire.prototype = new Light();
        //LightEntire.prototype.constructor = LightEntire;
        function extend(subClass,superClass) {
            var F = function () {};
            F.prototype = superClass.prototype;
            subClass.prototype = new F();
            subClass.prototype.constructor = subClass;
        }
        extend(LightEntire,Light);
        LightEntire.prototype.select = function () {
            self.add = 1;
        };
        LightEntire.prototype.lightOn = function (num) {
           Light.prototype.lightOn.call(this,num);
        };

        var  LightHalfEntire = function(el,options) {
           Light.call(this,el,options);
           this.selectEvent = "mousemove";
        };
        extend(LightHalfEntire,Light);
        LightHalfEntire.prototype.select = function (e,$this) {
            if(e.pageX - $this.offset().left < $this.width() /2){
                this.add = 0.5
            }else{
                this.add = 1;
            }
        };
        LightHalfEntire.prototype.lightOn = function (num) {
            var count  = parseInt(num);
            var isHalf = (count !== num);
            Light.prototype.lightOn.call(this,count);
            if(isHalf){
                this.$item.eq(count).css("background-position","0 -12px");
            }
        };
        var mymode = {
            half:LightHalfEntire,
            entire:LightEntire
        };
        var init  = function (el,option) {
            var $el = $(el),
                rating = $el.data("rating"),
                options = $.extend({},defaultoptions,typeof option === "object" && option);

            if(!mymode[options.mode]){
                options.mode = "entire";
            }
            if(!rating){
                $el.data("rating",(rating = new (mymode[options.mode])(el,options)));
                rating.init();
            }
            if(typeof option === "string"){
                rating[option]();
            }

        };
        $.fn.extend({
            rating:function (options) {
                return this.each(function () {
                    init(this,options);
                })
            }
        })

        return {
            init:init
        }
    })();


    // rating.init("#rating",{
    //     mode:"half",
    //     // num:2.5,
    //     readOnly:false,
    //     select:function (num ,all) {
    //         console.log(this);
    //         console.log(num + "/" + all);
    //     },
    //     chosen:function (index ,all) {
    //         console.log(index + "/" + all);
    //         rating.init("#rating","unbindEvent");
    //     }
    // });
    // $("#rating").on("select",function (e,num,all) {
    //     console.log(arguments);
    // }).on("chosen",function (e,num,all) {
    //     console.log(num + "/" + all + "----chosen");
    //     rating.init("#rating","unbindEvent");
    // })
    //
    // $("#rating2").rating({
    //     num:3,
    //     mode:'half'
    // })
    $(".rating").rating({
        num:4,
        mode:'half',
        chosen:function () {
            $(".rating").rating("unbindEvent");
        }
    })

</script>
</body>
</html>
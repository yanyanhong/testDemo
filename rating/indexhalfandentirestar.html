<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>rating</title>
    <style>
        .rating{
            width: 120px;
            height: 24px;
            margin: 50px auto;
        }

        .rating-item{
            list-style: none;
            float:left;
            width: 24px;
            height: 24px;
            background: url("img/rating.png") no-repeat;
            background-position: 0 0;
            cursor: pointer;
        }
    </style>
    <script src="http://img.mukewang.com/down/540812440001e40e00000000.js" type="text/javascript"></script>
</head>
<body>
    <ul class="rating" id="rating">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>

    <ul class="rating" id="rating2">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>

    <ul class="rating" id="rating3">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>

    <ul class="rating" id="rating4">
        <li class="rating-item" title="很不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>
<script>

    var rating = (function () {
        var defaultoptions = {
            mode:"entire",
            num: 2,
            readOnly:false,
            select:function () {
                
            },
            chosen:function () {
                
            }
        };
        var mode = {
            'half':LightHalfEntire,
            'entire':LightEntire
        }
        function LightEntire(el,options) {
            this.$el = $(el);
            this.$item = this.$el.find(".rating-item");
            this.opts = options;
        }
        LightEntire.prototype.init = function () {
            this.lightOn(this.opts.num);
            if(!this.opts.readOnly){
                this.bindEvent();
            }
        };
        LightEntire.prototype.bindEvent = function () {
            var self  = this,
                all = self.$item.length;
            self.$el.on("mouseover",".rating-item",function () {
                var num = $(this).index() + 1;
                self.lightOn(num);
                (typeof self.opts.select  === "function") && self.opts.select.call(this,num ,all);
                self.$el.trigger("select",[num ,all]);
            }).on("click",".rating-item",function () {
                var num = $(this).index() + 1;
                self.opts.num = num;
                (typeof self.opts.chosen === "function") && self.opts.chosen.call(this,num,all);
                self.$el.trigger("chosen",[num ,all]);
            }).on("mouseout",function () {
                self.lightOn(self.opts.num);
            })
        }
        LightEntire.prototype.lightOn = function (num) {
            num = parseInt(num);
            this.$item.each(function (index) {
                if(index < num){
                    $(this).css("background-position","0 -24px");
                }else{
                    $(this).css("background-position","0 0");
                }
            })
        };

        function LightHalfEntire(el,options) {
            this.$el = $(el);
            this.$item = this.$el.find(".rating-item");
            this.opts = options;
            this.add = 1;
        }
        LightHalfEntire.prototype.init = function () {
            this.lightOn(this.opts.num);
            if(!this.opts.readOnly){
                this.bindEvent();
            }
        };
        LightHalfEntire.prototype.bindEvent = function () {
            var self  = this,
                all = self.$item.length;
            // var num = 0;
            self.$el.on("mousemove",".rating-item",function (e) {
                var num = $(this).index();
                if(e.pageX - $(this).offset().left < $(this).width() /2){
                    self.add = 0.5
                }else{
                    self.add = 1;
                }
                num = num + self.add;
                self.lightOn(num );
                (typeof self.opts.select  === "function") && self.opts.select.call(this,num ,all);
                self.$el.trigger("select",[num ,all]);
            }).on("click",".rating-item",function (e) {
                self.opts.num = $(this).index() + self.add;
                (typeof self.opts.chosen === "function") && self.opts.chosen.call(this,$(this).index()+self.add,all);
                self.$el.trigger("chosen",[$(this).index()+self.add ,all]);
            }).on("mouseout",function () {
                self.lightOn(self.opts.num);
            })
        }
        LightHalfEntire.prototype.lightOn = function (num) {
            var isHalf = parseInt(num) !== num;
            this.$item.each(function (index) {
                if(index < num){
                    $(this).css("background-position","0 -24px");
                }else{
                    $(this).css("background-position","0 0");
                }
            });
            if(isHalf){
                this.$item.eq(parseInt(num)).css("background-position","0 -12px");
            }
        }
        var init  = function (el,options) {
            options = $.extend({},defaultoptions,options);

            if(!mode[options.mode]){
                options.mode = "entire";
            }
            if(typeof options.mode === "string"){
                new mode[options.mode](el,options).init();
            }
            // new LightHalfEntire(el,options).init();
        };

        return {
            init:init
        }
    })();


    rating.init("#rating",{
        mode:"fsdf",
        num:2.5,
        readOnly:false,
        select:function (num ,all) {
            console.log(this);
            console.log(num + "/" + all);
        },
        chosen:function (index ,all) {
            console.log(index + "/" + all);
        }
    });
    $("#rating").on("select",function (e,num,all) {
        console.log(arguments);
    }).on("chosen",function (e,num,all) {
        console.log(num + "/" + all + "----chosen");
    })
    // var rating = (function () {
    //
    //     function lightOn($item,num) {
    //         $item.each(function (index) {
    //             if(index < num){
    //                 $(this).css("background-position","0 -24px");
    //             }else{
    //                 $(this).css("background-position","0 0");
    //             }
    //         })
    //     }
    //
    //     var init = function (el ,num) {
    //         var $rating = $(el),
    //             $item = $rating.find(".rating-item");
    //
    //         lightOn($item,num);
    //
    //         $rating.on("mouseover",".rating-item",function () {
    //             lightOn($item,$(this).index() + 1);
    //             console.log(($(this).index() + 1 )+ "/" + $item.length);
    //         }).on("click",".rating-item",function () {
    //             num = $(this).index() + 1;
    //             console.log(($(this).index() + 1) + "/" + $item.length);
    //         }).on("mouseout",function () {
    //             lightOn($item,num);
    //         });
    //     };
    //
    //     $.fn.extend({
    //         rating:function (num) {
    //             return this.each(function () {
    //                 init(this,num)
    //             })
    //         }
    //     })
    //
    //     return {
    //         init : init
    //     };
    //
    // })();
    //
    // // rating.init("#rating",4);
    // //
    // // rating.init("#rating2",2);
    // $(".rating").rating(3);

</script>
</body>
</html>